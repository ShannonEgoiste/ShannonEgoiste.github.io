<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<link rel="stylesheet" href="customSelect.css" >
	<style>
		body{
			padding: 0;margin: 0;
			background-color: #222;
			font-family: sans-serif;
			color: #FFF;
		}		
		::-webkit-scrollbar {
			width: 4px;
		}
		::-webkit-scrollbar-track {
			background: #333;
		}
		::-webkit-scrollbar-thumb {
			background: #888;
		}
		::-webkit-scrollbar-thumb:hover {
			background: #555; 
		}

		.d-none{
			display: none;
		}
		.wrapper{
			position: fixed;
			display: flex;
			width: 100%;
			height: 100%;
			justify-content: center;
			align-items: center;
			flex-direction:	column;
		}
		.content{
			width: 400px;
			height: 100vh;
			display: flex;
			flex-direction: column;
			justify-content: space-evenly;
		}

		.flagArea{
			position: relative;
		}

		.flagArea > canvas{
			width: 80%;
			display: block;
			border-radius: 10px;
			border: 2px solid rgba(255,255,255,0.5);
		}

		.flagArea .working{
			z-index: 10;
			position: absolute;
			opacity: 0;
		}

		.guess > div{
			display: grid;
			grid-template-columns: 60% 15% 25%;
			background-color: rgba(0,0,0,0.2);
			border:1px solid #FFF;
			border-radius: 10px;
			margin: 20px 0;
			justify-items: center;
			align-items: center;
		}
		
		.guessLine > div{
			padding: 5px 0;
		}

		.guessPercent{
			text-align: center;
			width: 100%;
			border-left:  1px solid rgba(255,255,255,0.2);
			border-right: 1px solid rgba(255,255,255,0.2);
		}

		.guessPercent.victory{
			color:rgb(187, 255, 77);
		}

		.guessname{
			padding-left: 10px;
			word-wrap: break-word;
			word-break: break-all;
		}
		.guess img{
			display: block;
		}

		.header{
			width: 100%;
			padding: 20px 0;
			background-color: #000;
			display: grid;	
			grid-template-columns: 30% 40% 10% 20%;
			justify-items: center;
			align-items: center;
			margin-bottom:20px;
		}

		.icoReload{
			cursor: pointer;
			width: 24px;
			height: 24px;
			background-image: url("data:image/svg+xml,%3Csvg fill='%23ffffff' viewBox='0 0 32 32' version='1.1' xmlns='http://www.w3.org/2000/svg' stroke='%23ffffff'%3E%3Cg id='SVGRepo_bgCarrier' stroke-width='0'%3E%3C/g%3E%3Cg id='SVGRepo_tracerCarrier' stroke-linecap='round' stroke-linejoin='round'%3E%3C/g%3E%3Cg id='SVGRepo_iconCarrier'%3E%3Ctitle%3Ereload%3C/title%3E%3Cpath d='M0 16q0-2.784 1.088-5.312t2.912-4.384 4.384-2.912 5.344-1.088q2.784 0 5.312 1.088t4.384 2.912 2.912 4.384 1.088 5.312h2.304q0.736 0 1.28 0.416t0.8 1.024 0.16 1.28-0.64 1.184l-4.576 4.576q-0.672 0.672-1.6 0.672t-1.632-0.672l-4.576-4.576q-0.512-0.512-0.608-1.184t0.128-1.28 0.8-1.024 1.312-0.416h2.272q0-2.464-1.216-4.576t-3.328-3.328-4.576-1.216-4.608 1.216-3.328 3.328-1.216 4.576 1.216 4.608 3.328 3.328 4.608 1.216q1.728 0 3.36-0.64l3.424 3.392q-3.136 1.824-6.784 1.824-2.816 0-5.344-1.088t-4.384-2.912-2.912-4.384-1.088-5.344z'%3E%3C/path%3E%3C/g%3E%3C/svg%3E");
		}

		.footer{
			margin-top: 20px;
		}

		.hideToast{
			top: -100vh !important;
		}
		
		.victoryToast{
			position:fixed;
			top:30vh;
			left: 50%;
			transform: translate(-50%,-50%);
			transition: top 1s;

			border-radius: 10px;
			background-color: #FFF;
			color:#000;
			display: flex;
			flex-direction: column;
			padding: 30px;
			box-shadow: rgb(0, 0, 0) 5px 5px 20px 0px;
		}
	</style>
</head>
<body>
	<div class="wrapper">
		<div class="header">
			<div></div>
			<div>FLAGLE</div>
			<div><div class="icoReload"></div></div>
		</div>
		<div class="content">
			<div style="display: flex; justify-content: center;" class="flagArea">
				<canvas class="mask" height="160" height="256"></canvas>
				<canvas class="working"></canvas>
			</div>
			<div class="guess">
				<div class="guessLine"><div class="guessname"></div><div class="guessPercent">&nbsp;</div><div><img height="32px" src=""/></div></div>
				<div class="guessLine"><div class="guessname"></div><div class="guessPercent">&nbsp;</div><div><img height="32px" src=""/></div></div>
				<div class="guessLine"><div class="guessname"></div><div class="guessPercent">&nbsp;</div><div><img height="32px" src=""/></div></div>
				<div class="guessLine"><div class="guessname"></div><div class="guessPercent">&nbsp;</div><div><img height="32px" src=""/></div></div>
				<div class="guessLine"><div class="guessname"></div><div class="guessPercent">&nbsp;</div><div><img height="32px" src=""/></div></div>
				<div class="guessLine"><div class="guessname"></div><div class="guessPercent">&nbsp;</div><div><img height="32px" src=""/></div></div>
			</div>
			<div class="countrySelect">
				<div class="listCountry d-none"><table><tbody></tbody></table></div>
				<div style="display: flex;flex-direction: row;"><input type="text" class="userFlagInput" disabled/><button disabled class="countrySelectButton">Submit</button></div>
			</div>
			<div class="footer"></div>
		</div>			
	</div>

	<div class="victoryToast hideToast">
		<div style="font-size: 24px;text-align: center;" class="resultOfGuess">
			Congratulations !
		</div>
		<div style="font-size: 14px;text-align: center;color:#555;margin: 10px;">
			the country was
		</div>
		<div style="display: flex;justify-content: center;margin-bottom:20px;">
			<canvas style="display: block;height: 64px;border: 1px solid #333;border-radius: 5px;" class="ref"></canvas>
		</div>
		<div style="font-size: 24px;text-align: center;" class="toGuessCountryName"></div>
	</div>



	<script src="imgLogic.js"></script>
	<script src="customSelect.js"></script>


	<script type="module">
		import {listCountry,isoFromName} from "./isoCode.js";
		var country;
		var counter = 0;


		function fillGuessLine(dom,name,percent,src){
			dom.querySelector(".guessname").innerHTML = name;
			dom.querySelector(".guessPercent").innerHTML = percent;
			dom.querySelector(".guessPercent").classList.remove("victory");
			dom.querySelector("img").src = src;
		}

		function restart(){
			document.querySelector(".victoryToast").classList.add("hideToast");
			counter = 0;

			setTimeout(()=>{
				country = listCountry[Math.floor(Math.random()* listCountry.length)];	
				document.querySelector(".toGuessCountryName").innerHTML = country.n;
				init(country.i);
				document.querySelectorAll(".guessLine").forEach((x)=>{
					fillGuessLine(x,"","&nbsp;","");
				});
				document.querySelector(".userFlagInput").removeAttribute("disabled");
				document.querySelector(".countrySelectButton").removeAttribute("disabled");
			},1000);
		}

		document.querySelector(".icoReload").addEventListener("click",()=>restart());


		function makeAGuess(){
			var value = document.querySelector(".userFlagInput").value;
			document.querySelector(".userFlagInput").value = "";

			var isoCode = isoFromName(value);
			if(isoCode == -1) return;
			
			var percent = compareImage(isoCode);
			
			var workingCanvas = document.querySelector("canvas.working");
			workingCanvas.style.opacity = "100%";
			var guessLine = document.querySelectorAll(".guessLine")[counter];
			fillGuessLine(guessLine,value,0+"%","svg/"+isoCode+".svg");
			var percentCounter = 0;
			var intervalprogress = Math.max(1,percent/100);
			var inter = setInterval(()=>{
				var percentDom = guessLine.querySelector(".guessPercent");
				percentCounter+=intervalprogress;
				if(percentCounter > percent){
					var iOpacity = 100;
					var i2 = setInterval(()=>{
						if(iOpacity<=0){
							clearInterval(i2);
							workingCanvas.style.opacity = 0;
							return;
						}
						workingCanvas.style.opacity = iOpacity+"%";
						iOpacity--;
					},10);
					clearInterval(inter);
					return;
				}
				percentDom.innerHTML=Math.round(percentCounter)+"%";
			},10);

			if(isoCode == country.i){
				document.getElementsByClassName("guessPercent")[counter].classList.add("victory");
				document.querySelector(".resultOfGuess").innerHTML="Congratulations !!";
				document.querySelector(".userFlagInput").setAttribute("disabled",true);
				document.querySelector(".countrySelectButton").setAttribute("disabled",true);
				document.querySelector(".victoryToast").classList.remove("hideToast");
			}
			counter++;
			if(counter>5){
				document.querySelector(".resultOfGuess").innerHTML="You'll do better next time !";
				document.querySelector(".userFlagInput").setAttribute("disabled",true);
				document.querySelector(".countrySelectButton").setAttribute("disabled",true);
				document.querySelector(".victoryToast").classList.remove("hideToast");
			}
		}

		
		document.querySelector(".countrySelectButton").addEventListener("click",()=>makeAGuess());
		flagSelector(listCountry,()=>makeAGuess());
		
		restart();



		




	</script>
</body>
</html>