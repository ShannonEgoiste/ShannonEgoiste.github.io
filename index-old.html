<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body{
			margin: 0;padding: 0;
            background-color: #222;
        }

		.g > *{
			position: absolute;
		}

		.g > img{
			opacity: 0;
		}
		.workingcanvas{
			opacity: 0.1;
		}

    </style>
</head>
<body>
	<script>
        var canvas = document.querySelector(".workingcanvas");
        var ctx = canvas.getContext("2d",{willReadFrequently:true});
		
		var acanvas = document.querySelector(".answer");
		var actx = acanvas.getContext("2d");

        var refimgdom = document.querySelector(".refImage");
		var compareimagedom = document.querySelector(".compareImage");
		canvas.width = refimgdom.clientWidth;

		function normalizeColor(r,g,b){
			return [Math.floor(r),Math.floor(g),Math.floor(b)];
		}
		
		function getImageData(dom){
       		var refImgData = [];
            ctx.drawImage(dom,0,0,canvas.width,canvas.height);
            for(var y = 0 ; y < canvas.height; y++){
                var rowData = [];
                for(var x = 0; x < canvas.width;x++){
                    var color = ctx.getImageData(x,y,1,1).data;
                    rowData.push(normalizeColor(color[0],color[1],color[2]));
                }
                refImgData.push(rowData);
            }
			return refImgData;
		}
		
		function setRefCountry(iso){
			refimgdom.src = "svg/"+iso+".svg";
			acanvas.width = canvas.width = refimgdom.clientWidth;
			return getImageData(refimgdom);
			ctx.clearRect(0,0,ref[0].length,64);
		}
		var ref = setRefCountry("us");

		function compareImage(ref,comp){
			actx.fillStyle = "#00FF00";
			for(var y = 0;y<64;y++){
				for(var x = 0; x < ref[0].length;x++){
					var a = comp[y][x];
					var b = ref[y][x];
					if(b && a){
						var distance = Math.sqrt(Math.pow(b[0]-a[0],2)+Math.pow(b[1]-a[1],2)+Math.pow(b[2]-a[2],2));
						if(distance <100){
							actx.fillRect(x,y,1,1);
						}
					}
				}
			}
		}

		function makeGuess(iso){
			compareimagedom.src = "svg/"+iso+".svg";
			compareimagedom.onload = ()=>{
				var comp = getImageData(compareimagedom);
				compareImage(ref,comp);
			}
		}


    </script>
</body>
</html>